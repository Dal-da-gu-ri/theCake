{% extends 'base_baker.html' %}

{% block content %}
    <link rel="stylesheet" href="/static/css/changePw.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <div class="row">
        <p class="pt-3 pl-4 path">마이페이지 > 비밀번호 변경</p>
    </div>

    <div class="a_layer">
        <div class="a_layer_inner">
                <!-- 현재 비밀번호 입력 -->
<!--                <form method = "POST" class="form-currentPw">-->
<!--                    {% csrf_token %}-->


            <div class="a_content">
<!--                        <div class="d-flex justify-content-around align-items-center">-->
               <div class="form-inline form-group">
                  <label for="password_baker" class="col-sm-4 control-label">현재 비밀번호</label>
                  <input type="password"
                  class="col-lg-5 col-md-6 col-sm-6 form-control pw_baker"
                  id="password_baker"
                  placeholder="현재 비밀번호를 입력해주세요."
                  name= "password_baker"
                  minlength="8"
                  required>
                   <div class="ml-4">
                       <button id="pw_submit" class="btn btn-secondary btn-block" onclick="check_exist_pw();">확인</button>
                   </div>
               </div>
            </div>

            <form method = "POST" class="resetPw" onsubmit="return chkPW()">
                <div id="newPw" class="a_content" style="margin-top: 4em;">
                    <div style="border: 2px dashed #bcbcbc;">
                        <div class="ml-5 mt-3 mb-4">
                            <p align="left">비밀번호 재설정</p>
                        </div>
                       <div class="form-inline form-group">
                          <label for="new_pw_baker" class="col-sm-4 control-label">새 비밀번호</label>
                          <input type="password"
                          class="col-lg-5 col-md-6 col-sm-6 col-12 form-control pw_baker"
                          id="new_pw_baker"
                          placeholder="현재 비밀번호를 입력해주세요."
                          name= "new_pw_baker"
                          minlength="8"
                          required>
                       </div>
                       <div class="form-inline form-group">
                          <label for="re_new_pw_baker" class="col-sm-4 control-label">비밀번호 재확인</label>
                          <input type="password"
                          class="col-lg-5 col-md-6 col-sm-6 col-12 form-control pw_baker"
                          id="re_new_pw_baker"
                          placeholder="비밀번호 재확인"
                          name= "new_pw_baker"
                          minlength="8"
                          required>
                       </div>
                    </div>
                    <div class="alert alert-success" id="alert-success1">비밀번호가 일치합니다.</div>
                    <div class="alert alert-danger" id="alert-danger1">비밀번호가 일치하지 않습니다.</div>
                    <div class="ml-4">
                       <button type="submit" id="new_pw_submit" class="btn btn-secondary btn-block">확인</button>
                   </div>
                </div>
            </form>

    </div>

<!--비밀번호가 맞지 확인-->
<script>
    $(function () {
        $('#newPw').hide();
        $("#alert-success1").hide();
        $("#alert-danger1").hide();
        $("#submit").attr("disabled", "disabled");

            $("input").keyup(function() {
            var pwd1=$("#password_baker").val();
            var pwd2=$("#re-password_baker").val();


            if (pwd1 != "" || pwd2 != "") {
                if (pwd1 == pwd2) {
                    $("#alert-success1").show();
                    $("#alert-danger1").hide();
                    $("#submit").removeAttr("disabled");
                } else {
                    $("#alert-success1").hide();
                    $("#alert-danger1").show();
                }
            }
        });
    });
</script>

<script>
    function check_exist_pw(){
        var pw = $('#password_baker').val();

        $.ajax({
            url: {% url 'baker:changePw'%},
            data: {"pw": pw},
            method: "POST",
            dataType: "json"
             success: function(data){
                if(data.result == "success"){
                    alert("확인되었습니다.");
                    document.getElementById('password_baker').readOnly = true;
                    $(#pw_submit').attr('disabled', 'disabled');
                    $('#newPw').show();
                }
                else if(data.result == "fail"){
                    alert("비밀번호가 존재하지 않습니다.");
                }
             }
             error: function(data){
                alert("에러발생");
             }
        })
    }
</script>

<!--새 비밀번호 조건 확인-->
<script>
    function chkPW(){
         var pw = $(".pw_baker").val();
         var num = pw.search(/[0-9]/g);
         var eng = pw.search(/[a-z]/ig);
         var spe = pw.search(/[`~!@@#$%^&*|₩₩₩'₩";:₩/?]/gi);

         if(pw.length < 8 || pw.length > 20){
          alert("비밀번호를 8자리 ~ 20자리 이내로 입력해주세요.");
          return false;
         }else if(pw.search(/\s/) != -1){
          alert("비밀번호는 공백 없이 입력해주세요.");
          return false;
         }else if( (num < 0 && eng < 0) || (eng < 0 && spe < 0) || (spe < 0 && num < 0) ){
          alert("영문, 숫자, 특수문자 중 2가지 이상을 혼합하여 입력해주세요.");
          return false;
         }else {
            console.log("통과");
         }
    }
</script>
{% endblock %}

